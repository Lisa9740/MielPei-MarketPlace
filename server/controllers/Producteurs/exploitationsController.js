const db = require("../../models");
const Exploitation = db.Exploitation
const Product = db.Product
const Op = db.Sequelize.Op;

exports.create = (req, res) => {
    const {name, adresse, commune, longitude, latitude, description, userId} = req.body
    Exploitation.create({
        name: name,
        adresse: adresse,
        commune: commune,
        longitude: longitude,
        latitude: latitude,
        description: description,
        userId: userId
    }).then(data => {
        res.status(200).send(data);
    });

};

// Retrieve all Exploitations from the database.
exports.findAll = (req, res) => {
    Exploitation.findAll({
        attributes: ['id', 'name','commune','adresse', 'longitude', 'latitude', 'description', 'userId'],
    }).then(data => {
        res.status(200).send(data);
    });

};

exports.findOne = (req, res) => {
    Exploitation.findOne({
        where: {
            id: req.params.id,

        },
        attributes: ['id', 'name', 'commune', 'adresse', 'longitude', 'latitude', 'description', 'userId']
    }).then(data => {

        Product.findAll({
            where: {
                exploitationId: data.id,
            },
            attributes: ['id', 'name', 'price', 'inStock', 'quantity', 'description']
        }).then(product => {
            res.status(200).send({fiche: data, product: product});
        })

    })
};

    exports.findByUser =  (req, res) => {
        Exploitation.findOne({
            where : {
                userId : req.params.userId ,

            },
            attributes : ['id', 'name','commune','adresse', 'longitude', 'latitude', 'description', 'userId']
        }).then(data => {

            Product.findAll({
                where : {
                    exploitationId : data.id,
                },
                attributes : ['id', 'name', 'price', 'inStock', 'quantity', 'description' ]
            }).then(product => {
                res.status(200).send({fiche : data, product : product});
            })

        })



    };