<template>
  <div id="container">
    <v-row align="center" justify="center">
      <div id="mapContainer">
        <l-map
            v-if="showMap"
            :zoom="zoom"
            :center="center"
            :options="mapOptions"
            style="height: 100%"
            @update:center="centerUpdate"
            @update:zoom="zoomUpdate"
        >
          <l-tile-layer
              :url="url"
              :attribution="attribution"
          />
          <div v-if="exploitations[0]">
            <div v-for="(exploitation) in exploitations[0].data" :key="exploitation.id" >
              <l-marker @click="getDataExploitation(exploitation)" :lat-lng="[exploitation.latitude, exploitation.longitude]" :icon="icon" />
            </div>
          </div>

        </l-map>

      </div>

    </v-row>
    <v-dialog
        v-model="dialog"
        width="600px"
    >
      <v-card>
        <v-card-title>
          <span class="headline">Exploitation de {{ exploitationData.name }} à {{ exploitationData.commune }}</span>
        </v-card-title>
        <v-card-text>
         {{ exploitationData.description}}

          +
        </v-card-text>
        <v-card-actions>
          <v-spacer></v-spacer>
          <v-btn
              color="#1d2933 darken-1"
              text
              @click="accessToProducteurFiche(exploitationData)"
          >
            Accèder fiche producteur
          </v-btn>
        </v-card-actions>
      </v-card>
    </v-dialog>
  </div>
</template>
<style>
#mapContainer{
  height: 350px !important;
}
</style>
<script>
import "leaflet/dist/leaflet.css";
import { latLng, icon } from "leaflet";
import { LMap, LTileLayer, LMarker} from "vue2-leaflet";


export default {
  name: "MapExploitation",
  components: {
    LMap,
    LTileLayer,
    LMarker,
  },
  data() {
    return {
      zoom: 8,
      center: latLng(-21.107883,55.504303),
      url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      attribution:
          '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
      icon: icon({
          iconUrl: '../marker-icon.png',
        iconSize: [32, 37],
        iconAnchor: [16, 37]
      }),
      staticAnchor: [16, 37],
      customText: "Foobar",
      iconSize: 64,
      currentZoom: 15.5,
      currentCenter: latLng(-21.107883,55.504303),
      withPopup: latLng(-21.107883, 55.504303),
      withTooltip: latLng(-21.107883, 55.504303),
      showParagraph: false,
      marker: latLng(-21.107883, 55.504303),
      mapOptions: {
        zoomSnap: 0.5
      },
      showMap: true,
      dialog: false,
      exploitationData: [],
    }
  },
  computed:{
    products() {
      return this.$store.state.products
    },
    exploitations() {
      return this.$store.state.exploitations
    },
    dynamicSize() {
      return [this.iconSize, this.iconSize * 1.15];
    },
    dynamicAnchor() {
      return [this.iconSize / 2, this.iconSize * 1.15];
    }

  },

  methods: {
    zoomUpdate(zoom) {
      this.currentZoom = zoom;
    },
    centerUpdate(center) {
      this.currentCenter = center;
    },
    getDataExploitation(exploitation){
      this.dialog = true
      this.exploitationData = exploitation
    },
    accessToProducteurFiche(exploitationData){
      this.$router.push('/fiche/' + exploitationData.id);
    },
    showLongText() {
      this.showParagraph = !this.showParagraph;
    },
    innerClick() {
      alert("Click!");
    }
  },
  mounted() {
    this.$store.dispatch("getExploitations");

  },
}
</script>